# =============================================================================
#                  CONFIGURATION FILE FOR QUBES-BUILDER
# =============================================================================
#
# THIS CONFIGURATION FILE IS INDENDED TO ONLY BE USED WITH THE `setup` SCRIPT.
# -----------------------------------------------------------------------------
# 
# This configuration file (`templates.conf`) will be linked to by `setup` as
# `builder.conf`.  (ln -s example-configs/templates.conf builder.conf)
#
# To use the `setup` script, just run `setup` in the qubes-builder root
# directory.  A series of dialogs will be presented prompting various 
# configuration available and then all build configuration files will 
# automatically be generated based on the options selected.
#
# `setup` can be re-run again at any time to change configuration options.
# Previous options selected will be retained to allow quick switching of
# branches, templates to build, etc.
#
# -----------------------------------------------------------------------------
#            CONFIGURATION FILES INCLUDED WITH THIS CONFIGURATION
# -----------------------------------------------------------------------------
# Other configuration files are also included to offer maximum flexibility.  To
# determine which configuration files are actually being included when using
# this configuration file as a base, use the `about` target:
#   `make about`
#
# The other configuration files included (if they exist which some of them are 
# automatically generated by `setup`) are as follows:
# - builder-release.conf: Contains RELEASE and GIT_PREFIX
# - example-configs/qubes-os-r2.conf: If RELEASE == 2; Default Release 2
#   configuration file
# - example-configs/qubes-os-master.conf: If RELEASE == 3; Default Release 3 
#   configuration file
# - setup.conf: Configurations selected after running the `setup` script
# - override.conf: `setup` will also offer to include `override.conf` if one 
#   exists.  More information on `overrides` below.
# - example-configs/extended-rules.conf: Contains extra targets mostly for 
#   building templates
#
# -----------------------------------------------------------------------------
#                            ADDITIONAL OVERRIDES
# -----------------------------------------------------------------------------
# Instead of directly modifying this or any other `default` configuration
# file, an override.conf file can be placed in the `qubes-builder` root 
# directory.  `setup` will offer to include this file if it exists.
#
# The `override.conf` file can contain overrides to most any configuration
# option such as BRANCH, DEBUG, VERBOSE, etc.
# 
# If you create `overrides` that are specific to a release version or custom
# branch you are working on, `setup` will also be able to indentify overrides
# specific to the release and or branch.
#
# To create release / branch specific `overrides`, create an overide 
# configuration file and place it in the `example-configs` directory named
# as follows:
#   1) example-configs/r2-feature_branch-override.conf
#   2) example-configs/r3-feature_branch-override.conf
#   3) example-configs/feature_branch-override.conf
#   4) example-configs/override.conf
#   5) override.conf
#
# Option 1 above would offer to include the override configuration file if you 
# selected to build for Release 2 and are currently in the `feature_branch`
# branch.
#
# Option 2 is the same as Option 1 except for Release 3.
#
# Option 3 would use the same configuration override for both Release 2 and 3
# if you are currently in the `feature_branch` branch.
# 
# If there is no release / branch specific override configuration and 
# override.conf exists as in options 4, that will be available to select.
#
# Finally, an override.conf file in the `qubes-builder` root directory 
# overrides all the above examples.
#
#
# A few additionsl notes and caveats on overrides: 
#
# - The dialog to choose an override configuration is only presented on the 
#   initial run of `setup`.  Once a `builder.conf` file created, there will be
#   no further prompts.  As indicated above, `setup` initially soft links 
#   `examples-config/templates.conf` to `builder.conf`.  To overcome
#   this limitation, simply delete the `builder.conf` soft link and then the
#   override prompt will become available again when you re-run `setup`.
#
# - The `setup` script soft links any override configuration within the 
#   examples-config directory to overrides.conf.  It will allow any soft linked
#   override to be replaced with a newly selected override option, but will not
#   allow an existing `override.conf` regular file to be overwritten that is 
#   in the `qubes-builder` root directory.
#
# -----------------------------------------------------------------------------
# All lines which begins with "#" are treated as comments
# Assigments can be made with VAR_NAME="VALUE" 

-include builder-release.conf

# `setup` will define RELEASE in the automatically generated 
# `builder-release.conf` file
RELEASE ?= 2
RELEASE_INDEX = $(shell echo "$(RELEASE)-1" | bc)

# A Qubes master configuration file will be included based on selctect RELEASE
ifeq ($(RELEASE), 2)
  -include example-configs/qubes-os-r2.conf
else
  -include example-configs/qubes-os-master.conf
endif

# `setup` will define GIT_PREFIX in the automatically generated 
# `builder-release.conf` file
GIT_PREFIX ?= QubesOS/qubes-

VERBOSE = 0
NO_SIGN = 1
DEBUG = 0

DIST_DOM0 ?= fc20

################################################################################
#                     L I S T   O F   D I S T   V M ' S
################################################################################
# List of all build template variations that will be offered in the 'setup'
# DISTS_VM dialog to be able to choose from
#
# Available template flavors may be added the the template build by appending
# `+flavor_name`
ifndef DISTS_DEFINED
  DISTS_VM := 
  DISTS_VM += wheezy
  DISTS_VM += wheezy+flash
  DISTS_VM += wheezy+gnome
  DISTS_VM += wheezy+gnome+flash
  DISTS_VM += jessie
  DISTS_VM += jessie+flash
  DISTS_VM += jessie+gnome
  DISTS_VM += jessie+gnome+flash
  DISTS_VM += trusty
  DISTS_VM += trusty+flash
  DISTS_VM += trusty+desktop
  DISTS_VM += trusty+desktop+flash
  DISTS_VM += utopic
  DISTS_VM += utopic+flash
  DISTS_VM += utopic+desktop
  DISTS_VM += utopic+desktop+flash
  DISTS_VM += vivid
  DISTS_VM += vivid+flash
  DISTS_VM += vivid+desktop
  DISTS_VM += vivid+desktop+flash
  DISTS_VM += wheezy+whonix-gateway
  DISTS_VM += wheezy+whonix-workstation
  DISTS_VM += wheezy+whonix-workstation+flash
  DISTS_VM += wheezy+whonix-workstation+gnome
  DISTS_VM += wheezy+whonix-workstation+gnome+flash
  DISTS_VM += fc20
  DISTS_VM += fc20+minimal
  DISTS_VM += fc20+fullyloaded
  DISTS_VM += fc21
  DISTS_VM += fc21+minimal
  DISTS_VM += fc21+fullyloaded
endif

################################################################################
#                 T E M P L A T E   C O N F I G U R A T I O N
################################################################################
# TEMPLATE_LABEL allows control over the final template name.  There is a limit
# of 31 characters for the final template name
# 
# TEMPLATE_LABE += <DIST_VM name as listed above>:<desired final template name>
TEMPLATE_LABEL ?=
TEMPLATE_LABEL += wheezy:debian-7-x64
TEMPLATE_LABEL += wheezy+flash:debian-7-x64
TEMPLATE_LABEL += wheezy+gnome:debian-7-x64-gnome
TEMPLATE_LABEL += wheezy+gnome+flash:debian-7-x64-gnome
TEMPLATE_LABEL += jessie:debian-8-x64
TEMPLATE_LABEL += jessie+flash:debian-8-x64
TEMPLATE_LABEL += jessie+gnome:debian-8-x64-gnome
TEMPLATE_LABEL += jessie+gnome+flash:debian-8-x64-gnome
TEMPLATE_LABEL += trusty:qubuntu-trusty-x64
TEMPLATE_LABEL += trusty+flash:qubuntu-trusty-x64
TEMPLATE_LABEL += trusty+desktop:qubuntu-trusty-x64-desktop
TEMPLATE_LABEL += trusty+desktop+flash:qubuntu-trusty-x64-desktop
TEMPLATE_LABEL += utopic:qubuntu-utopic-x64
TEMPLATE_LABEL += utopic+flash:qubuntu-utopic-x64
TEMPLATE_LABEL += utopic+desktop:qubuntu-utopic-x64-desktop
TEMPLATE_LABEL += utopic+desktop+flash:qubuntu-utopic-x64-desktop
TEMPLATE_LABEL += vivid:qubuntu-vivid-x64
TEMPLATE_LABEL += vivid+flash:qubuntu-vivid-x64
TEMPLATE_LABEL += vivid+desktop:qubuntu-vivid-x64-desktop
TEMPLATE_LABEL += vivid+desktop+flash:qubuntu-vivid-x64-desktop
TEMPLATE_LABEL += wheezy+whonix-gateway:whonix-gateway-experimental
TEMPLATE_LABEL += wheezy+whonix-workstation:whonix-workstation-experimental
TEMPLATE_LABEL += wheezy+whonix-workstation+flash:whonix-workstation-experimental
TEMPLATE_LABEL += wheezy+whonix-workstation+gnome:whonix-workstation-gnome
TEMPLATE_LABEL += wheezy+whonix-workstation+gnome+flash:whonix-workstation-gnome

# Location of templates flavors that are not in default location. 
# Example: wheezy+whonix-gateway would normally be in 
#          (Don't Place in {curly} brackets; ending curly gets cut off
#          $$SCRIPTSDIR/wheezy+whonix-gateway
#   -or-   $$SCRIPTSDIR/wheezy
TEMPLATE_FLAVOR_DIR :=
TEMPLATE_FLAVOR_DIR += +gnome:$$SCRIPTSDIR/gnome
TEMPLATE_FLAVOR_DIR += +flash:$$SCRIPTSDIR/flash
TEMPLATE_FLAVOR_DIR += +desktop:$$SCRIPTSDIR/desktop

################################################################################
#                  T E M P L A T E   C O M P O N E N T S
################################################################################
# Contains a list of components when only building templates.  Note the build
# order is very important
TEMPLATE :=
TEMPLATE += vmm-xen
TEMPLATE += core-vchan-xen
ifeq ($(RELEASE), 3)
  TEMPLATE += core-qubesdb
endif
TEMPLATE += linux-utils
TEMPLATE += core-agent-linux
TEMPLATE += gui-common
TEMPLATE += gui-agent-linux
TEMPLATE += app-linux-split-gpg
TEMPLATE += app-linux-tor
TEMPLATE += app-thunderbird
TEMPLATE += app-linux-pdf-converter
TEMPLATE += linux-template-builder

################################################################################
#                              W H O N I X
################################################################################
# Whonix
WHONIX_DIR = $(shell readlink -m ./qubes-src/Whonix)
WHONIX_COMPONENTS := Whonix
GIT_URL_Whonix = https://github.com/Whonix/Whonix.git
BRANCH_Whonix = 9.6

# qubes-whonix
WHONIX_COMPONENTS += qubes-whonix
GIT_URL_qubes_whonix = https://github.com/Whonix/qubes-whonix.git
BRANCH_qubes_whonix = 9.6.2

# whonix-setup-wizard
WHONIX_COMPONENTS += whonix-setup-wizard
GIT_URL_whonix_setup_wizard = https://github.com/Whonix/whonix-setup-wizard.git
BRANCH_whonix_setup_wizard = 0.5-1

# python-guimessages
WHONIX_COMPONENTS += python-guimessages
GIT_URL_python_guimessages = https://github.com/Whonix/python-guimessages.git
BRANCH_python_guimessages = 0.3-1

################################################################################
#                        M I S C E L L A N E O U S 
################################################################################
# Qubes-builder deps
DEPENDENCIES := git rpmdevtools rpm-build createrepo

# Additional for debian template
DEPENDENCIES += debootstrap dpkg-dev

# If setup script was used to build configuration file, load it now
-include setup.conf

# Contains mostly additional targets specific for templates or Whonix
-include example-configs/extended-rules.conf

.PHONY: about release
about::
	@echo "templates.conf"

release:
	@echo "$(RELEASE)"

# vim: filetype=make
